extends ./layout.jade



block body

  script(src='https://online.tableau.com/javascripts/api/tableau-2.js')
  script(type='text/javascript').
    window.onload = function() {
    var sheetDiv = document.getElementById("visualization");
    var sheetURL = '#{game.tableau}';
    var sheetOptions = {
      hideTab: true,
      hideToolbar: true,
      width: "450px",
      height: "450px",
    };
    viz = new tableauSoftware.Viz(sheetDiv, sheetURL, sheetOptions);
    };
  #game-heading 
    h3 #{pitcher.firstname} #{pitcher.lastname}, ##{pitcher.number}
    h4 #{pitcher.playercity} #{pitcher.playerteam} vs. #{game.opponentcity} #{game.opponentname} (#{game.date.getMonth()+1}/#{game.date.getDate()+1}/#{game.date.getFullYear()})
  if game.tableau  
    h5 Pitches and Locations
    #visualization
    p
  script(type='text/javascript').
    $(function() {
      var month = '#{game.date.getMonth()+1}';
      month = ('0' + month).slice(-2);
      var day = '#{game.date.getDate()+1}';
      day = ('0' + day).slice(-2);
      var year = '#{game.date.getFullYear()}';
      var scores = 'http://gd2.mlb.com/components/game/mlb/year_' + year + '/month_' + month + '/day_' + day + '/miniscoreboard.json';
      //- var scores = "http://gd2.mlb.com/components/game/mlb/year_2016/month_04/day_14/miniscoreboard.json";
      $.getJSON(scores, function(gameResults) {
        var games = gameResults.data.games.game;
        for(i=0; i<games.length; i++) {
          if((games[i].away_team_city === '#{pitcher.playercity}') || (games[i].home_team_city === '#{pitcher.playercity}')) {
            $('#game-heading').after(
              '<table>' +
              '<tr>' +
              '<td style="font-weight: bold;">Team</td>' +
              '<td style="font-weight: bold;">Runs</td>' +
              '<td style="font-weight: bold;">Hits</td>' +
              '<td style="font-weight: bold;">Errors</td>' +
              '</tr>' +
              '<tr>' +
              '<td>'+
              games[i].home_team_city + ' ' + games[i].home_team_name +
              '</td>' +
              '<td style="text-align: center;">' +
              games[i].home_team_runs +
              '</td>' +
              '<td style="text-align: center;">' +
              games[i].home_team_hits +
              '</td>' +
              '<td style="text-align: center;">' +
              games[i].home_team_errors +
              '</td>' +
              '</tr>' +
              '<tr>' +
              '<td>' +
              games[i].away_team_city + ' ' + games[i].away_team_name +
              '</td>' +
              '<td style="text-align: center;">' +
              games[i].away_team_runs +
              '</td>' +
              '<td style="text-align: center;">' +
              games[i].away_team_hits +
              '</td>' +
              '<td style="text-align: center;">' +
              games[i].away_team_errors +
              '</td>' +
              '</tr>' +
              '</table>');
            }
          }
        });
      });
